node {
    environment {
        env.URL = "https://github.com/nvestan/helm.git"  // Git repo URL
    }
    
    stage('Integrate Remote k8s with Jenkins') {
        sh "mkdir -p ~/.kube"
        withCredentials([file(credentialsId: 'kube', variable: 'FILE')]) {
            sh 'cp $FILE ~/.kube/config'
        }
        sh "curl -LO 'https://dl.k8s.io/release/v1.32.2/bin/linux/amd64/kubectl'"
        sh "chmod +x kubectl"
        sh "./kubectl get nodes"
        sh "./kubectl get pods"
    }
    stage('Source') {
        script{
            git branch: 'main',
                credentialsId: 'nvestan_secret',
                url: 'URL'
        }
        sh "ls -al"
    }
    
    stage('Install Helm') {
        sh 'curl -LO "https://get.helm.sh/helm-v3.16.4-linux-amd64.tar.gz"'
        sh 'tar -zxvf helm-*-linux-amd64.tar.gz'
        sh 'cp linux-amd64/helm helm'
        sh './helm version'
        sh './helm list'
        sh 'ls -al'
        sh './helm install nginx nginx/ -n mamba --dry-run'
    }
}
