node {
    environment {
        env.URL = "https://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@github.com/nvestan/helm.git"  // Git repo URL
    }
    
    stage('Integrate Remote k8s with Jenkins') {
        sh "rm -rf *"
        sh "mkdir -p ~/.kube"
        withCredentials([file(credentialsId: 'kube', variable: 'FILE')]) {
            sh 'cp $FILE ~/.kube/config'
        }
        sh "curl -LO 'https://dl.k8s.io/release/v1.32.2/bin/linux/amd64/kubectl'"
        sh "chmod +x kubectl"
        sh "./kubectl get nodes"
        sh "./kubectl get pods"
    }

    stage('Install Helm') {
        sh 'curl -LO "https://get.helm.sh/helm-v3.16.4-linux-amd64.tar.gz"'
        sh 'tar -zxvf helm-*-linux-amd64.tar.gz'
        sh 'cp linux-amd64/helm helm'
        sh './helm version'
        sh './helm list'
        sh 'ls -al'
    }
    stage('Clone GitHub Repo via SSH') {
        withCredentials([sshUserPrivateKey(credentialsId: 'github-ssh-key', keyFileVariable: 'SSH_KEY')]) {
            sh """
                ls -al
                pwd
                eval \$(ssh-agent -s)
                ssh-add \$SSH_KEY
                ssh-keyscan github.com >> ~/.ssh/known_hosts
                git clone git@github.com:nvestan/district16.git
                ls -al district16
                ls -al district16/
                ls -al
                cd district16
                git submodule add -b feature git@github.com:nvestan/docker-react.git district16/library/
                ls district16/
                ls -al district16/library/
            """
        }
    }
}
